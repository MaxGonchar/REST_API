# HTTP Headers in REST API

## Introduction

HTTP headers are key-value pairs sent between client and server that provide **metadata** about the request or response. They carry important information beyond the actual data payload.

**Structure:**
```
Header-Name: Header-Value
```

**Example:**
```http
GET /api/users/42
Host: api.example.com
Authorization: Bearer eyJhbGc...
Content-Type: application/json
Accept: application/json
User-Agent: MyApp/1.0
```

**Key concept:** Headers make messages self-descriptive by providing context, instructions, and metadata.

---

## Categories of Headers

### 1. Request Headers
Sent by client to server, describe the request and client preferences.

### 2. Response Headers
Sent by server to client, describe the response and server state.

### 3. Representation Headers
Describe the payload (content encoding, type, length).

### 4. General Headers
Apply to both requests and responses.

---

## Essential Request Headers

### Authorization

**Purpose:** Carries credentials for authenticating the client.

**Mandatory:** Required for protected endpoints.

**Common Schemes:**

#### Bearer Token (Most common for REST APIs)
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Use for:** JWT tokens, OAuth 2.0 access tokens

#### Basic Authentication
```http
Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
```

**Format:** Base64 encoded `username:password`
**Security:** ⚠️ Only use over HTTPS!

#### API Key
```http
Authorization: ApiKey your-api-key-here
```

or custom header:
```http
X-API-Key: your-api-key-here
```

#### OAuth 2.0
```http
Authorization: Bearer access_token_here
```

**Best Practices:**
```javascript
// ✅ Good - Standard header
Authorization: Bearer token123

// ❌ Avoid - Non-standard
X-Auth-Token: token123
X-Session-Id: session123
```

**Example with validation:**
```javascript
// Server-side validation
app.use((req, res, next) => {
  const authHeader = req.headers.authorization;
  
  if (!authHeader) {
    return res.status(401).json({
      error: 'Authorization header required'
    });
  }
  
  const [scheme, token] = authHeader.split(' ');
  
  if (scheme !== 'Bearer') {
    return res.status(401).json({
      error: 'Invalid authorization scheme'
    });
  }
  
  try {
    const decoded = jwt.verify(token, SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({
      error: 'Invalid or expired token'
    });
  }
});
```

---

### Content-Type

**Purpose:** Indicates the media type of the request body.

**Mandatory:** Required for POST, PUT, PATCH requests with body.

**Common Values:**

```http
Content-Type: application/json
Content-Type: application/xml
Content-Type: application/x-www-form-urlencoded
Content-Type: multipart/form-data
Content-Type: text/plain
Content-Type: application/octet-stream
```

**Examples:**

#### JSON (Most common)
```http
POST /api/users
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com"
}
```

#### Form Data
```http
POST /api/users
Content-Type: application/x-www-form-urlencoded

name=John+Doe&email=john%40example.com
```

#### File Upload
```http
POST /api/uploads
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="photo.jpg"
Content-Type: image/jpeg

[binary data]
------WebKitFormBoundary7MA4YWxkTrZu0gW--
```

#### JSON with charset
```http
Content-Type: application/json; charset=utf-8
```

**Convention:** Always specify Content-Type when sending data.

---

### Accept

**Purpose:** Tells server what content types the client can handle.

**Mandatory:** No, but strongly recommended.

**Common Values:**

```http
Accept: application/json
Accept: application/xml
Accept: text/html
Accept: image/png
Accept: */*
```

**Quality values (preferences):**
```http
Accept: application/json, application/xml;q=0.9, */*;q=0.8
```

This means:
- Prefer `application/json` (quality 1.0 by default)
- `application/xml` is acceptable (quality 0.9)
- Any format is acceptable (quality 0.8)

**Example workflow:**

```http
// Client request
GET /api/users/42
Accept: application/json

// Server response
HTTP/1.1 200 OK
Content-Type: application/json

{ "id": 42, "name": "John" }
```

```http
// Client requests XML
GET /api/users/42
Accept: application/xml

// Server can provide XML
HTTP/1.1 200 OK
Content-Type: application/xml

<user>
  <id>42</id>
  <name>John</name>
</user>
```

```http
// Server can't provide requested format
GET /api/users/42
Accept: application/pdf

// Server response
HTTP/1.1 406 Not Acceptable
Content-Type: application/json

{
  "error": "Not Acceptable",
  "message": "Server only supports application/json",
  "supportedTypes": ["application/json"]
}
```

---

### Accept-Language

**Purpose:** Indicates client's preferred language(s).

**Mandatory:** No.

**Format:**
```http
Accept-Language: en-US
Accept-Language: en-US, en;q=0.9, es;q=0.8
Accept-Language: fr-FR, fr;q=0.9, en;q=0.8, *;q=0.5
```

**Example:**
```http
GET /api/products/42
Accept-Language: es-ES, es;q=0.9

Response:
HTTP/1.1 200 OK
Content-Language: es

{
  "id": 42,
  "nombre": "Producto Ejemplo",
  "descripcion": "Descripción en español"
}
```

**Server-side implementation:**
```javascript
app.get('/api/products/:id', async (req, res) => {
  const language = req.acceptsLanguages(['en', 'es', 'fr']) || 'en';
  const product = await getProduct(req.params.id, language);
  
  res.set('Content-Language', language);
  res.json(product);
});
```

---

### Accept-Encoding

**Purpose:** Indicates what content encodings (usually compression) the client can handle.

**Mandatory:** No.

**Common Values:**
```http
Accept-Encoding: gzip
Accept-Encoding: gzip, deflate, br
Accept-Encoding: gzip, deflate;q=1.0, *;q=0.5
```

**Example:**
```http
GET /api/large-data
Accept-Encoding: gzip, deflate, br

Response:
HTTP/1.1 200 OK
Content-Encoding: gzip
Content-Type: application/json
Content-Length: 1024

[compressed data]
```

**Benefits:** Reduces bandwidth usage by 60-80% for text data.

---

### User-Agent

**Purpose:** Identifies the client application making the request.

**Mandatory:** No, but commonly sent.

**Examples:**
```http
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
User-Agent: MyApp/1.0 (iOS 15.0; iPhone)
User-Agent: curl/7.68.0
User-Agent: PostmanRuntime/7.29.2
```

**Usage:**
- Analytics and monitoring
- Debugging client issues
- API versioning based on client
- Feature detection

```javascript
// Server-side usage
app.use((req, res, next) => {
  const userAgent = req.headers['user-agent'];
  
  // Log for analytics
  analytics.track({
    endpoint: req.path,
    userAgent: userAgent,
    timestamp: new Date()
  });
  
  // Handle deprecated clients
  if (userAgent.includes('MyApp/1.0')) {
    res.set('X-Deprecated-Version', 'true');
    res.set('X-Upgrade-URL', 'https://example.com/download');
  }
  
  next();
});
```

---

### Host

**Purpose:** Specifies the domain name of the server.

**Mandatory:** YES (required by HTTP/1.1 spec).

**Format:**
```http
Host: api.example.com
Host: api.example.com:8080
```

**Why mandatory:** 
- Enables virtual hosting (multiple domains on one server)
- Required for routing in reverse proxies

**Example:**
```http
GET /api/users
Host: api.example.com
```

**Note:** Usually handled automatically by HTTP clients.

---

### Referer (sic)

**Purpose:** Indicates the URL of the page that linked to the current request.

**Mandatory:** No.

**Note:** Spelled "Referer" (not "Referrer") due to original HTTP spec typo.

**Example:**
```http
GET /api/products/42
Referer: https://example.com/shop

// or
Referer: https://google.com/search?q=products
```

**Usage:**
- Analytics (where traffic comes from)
- Security (CSRF protection)
- Access control

---

### Origin

**Purpose:** Indicates where a cross-origin request originated.

**Mandatory:** Automatically sent by browsers for CORS requests.

**Format:**
```http
Origin: https://example.com
```

**Example:**
```http
POST /api/users
Origin: https://frontend.example.com
Content-Type: application/json

{ "name": "John" }
```

**Server checks origin for CORS:**
```javascript
app.post('/api/users', (req, res) => {
  const origin = req.headers.origin;
  const allowedOrigins = ['https://frontend.example.com', 'https://app.example.com'];
  
  if (allowedOrigins.includes(origin)) {
    res.set('Access-Control-Allow-Origin', origin);
    res.set('Access-Control-Allow-Credentials', 'true');
  }
  
  // Process request...
});
```

---

### If-None-Match

**Purpose:** Used for conditional requests with ETags (caching).

**Mandatory:** No.

**Format:**
```http
If-None-Match: "abc123"
If-None-Match: "abc123", "xyz789"
If-None-Match: *
```

**Example:**
```http
// First request
GET /api/data
→ Response:
HTTP/1.1 200 OK
ETag: "abc123"
{ "data": "..." }

// Second request (data cached)
GET /api/data
If-None-Match: "abc123"

→ Response:
HTTP/1.1 304 Not Modified
ETag: "abc123"
(no body - use cached version)

// If data changed:
GET /api/data
If-None-Match: "abc123"

→ Response:
HTTP/1.1 200 OK
ETag: "xyz789"
{ "data": "new data" }
```

---

### If-Modified-Since

**Purpose:** Used for conditional requests with timestamps (caching).

**Mandatory:** No.

**Format:**
```http
If-Modified-Since: Wed, 21 Oct 2025 07:28:00 GMT
```

**Example:**
```http
// First request
GET /api/document
→ Response:
HTTP/1.1 200 OK
Last-Modified: Wed, 21 Oct 2025 07:28:00 GMT
{ "content": "..." }

// Second request
GET /api/document
If-Modified-Since: Wed, 21 Oct 2025 07:28:00 GMT

→ Response (not modified):
HTTP/1.1 304 Not Modified

→ Response (if modified):
HTTP/1.1 200 OK
Last-Modified: Thu, 22 Oct 2025 09:15:00 GMT
{ "content": "updated..." }
```

---

### If-Match

**Purpose:** Used for optimistic locking and preventing lost updates.

**Mandatory:** No, but critical for concurrent updates.

**Format:**
```http
If-Match: "abc123"
```

**Example (preventing lost updates):**
```http
// User A gets resource
GET /api/documents/42
→ Response:
HTTP/1.1 200 OK
ETag: "v1"
{ "title": "Document", "content": "..." }

// User B gets same resource
GET /api/documents/42
→ Response:
HTTP/1.1 200 OK
ETag: "v1"
{ "title": "Document", "content": "..." }

// User A updates
PUT /api/documents/42
If-Match: "v1"
{ "title": "Updated by A" }
→ Response:
HTTP/1.1 200 OK
ETag: "v2"

// User B tries to update (will fail)
PUT /api/documents/42
If-Match: "v1"
{ "title": "Updated by B" }
→ Response:
HTTP/1.1 412 Precondition Failed
ETag: "v2"
{
  "error": "Resource was modified by another user",
  "currentVersion": "v2"
}
```

---

### Range

**Purpose:** Request only part of a resource (partial content).

**Mandatory:** No.

**Format:**
```http
Range: bytes=0-1023
Range: bytes=1024-2047
Range: bytes=0-999, 2000-2999
```

**Example:**
```http
GET /api/files/large-video.mp4
Range: bytes=0-1048575

Response:
HTTP/1.1 206 Partial Content
Content-Range: bytes 0-1048575/104857600
Content-Length: 1048576
Content-Type: video/mp4

[first 1MB of video]
```

**Use cases:**
- Video/audio streaming
- Resume interrupted downloads
- Loading large files in chunks

---

## Essential Response Headers

### Content-Type

**Purpose:** Indicates the media type of the response body.

**Mandatory:** Should always be present when there's a body.

**Examples:**
```http
Content-Type: application/json; charset=utf-8
Content-Type: application/xml
Content-Type: text/html
Content-Type: image/png
Content-Type: application/pdf
```

**Convention:** Always include charset for text formats:
```http
Content-Type: application/json; charset=utf-8
```

---

### Content-Length

**Purpose:** Size of the response body in bytes.

**Mandatory:** No, but strongly recommended.

**Format:**
```http
Content-Length: 1234
```

**Example:**
```http
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 67

{
  "id": 42,
  "name": "John Doe",
  "email": "john@example.com"
}
```

**Benefits:**
- Client knows when download is complete
- Progress indicators
- Connection management

---

### Location

**Purpose:** Indicates the URI of a newly created resource or redirect target.

**Mandatory:** Required for 201 (Created) and 3xx redirects.

**Examples:**

#### Resource Creation
```http
POST /api/users

Response:
HTTP/1.1 201 Created
Location: /api/users/42
Content-Type: application/json

{
  "id": 42,
  "name": "John Doe"
}
```

#### Redirect
```http
HTTP/1.1 301 Moved Permanently
Location: /api/v2/users
```

#### Async Operation
```http
POST /api/reports/generate

Response:
HTTP/1.1 202 Accepted
Location: /api/jobs/abc-123
Content-Type: application/json

{
  "jobId": "abc-123",
  "status": "processing"
}
```

---

### ETag

**Purpose:** Identifier for a specific version of a resource (for caching and concurrency).

**Mandatory:** No, but highly recommended for caching.

**Format:**
```http
ETag: "abc123"
ETag: W/"weak-etag"  // Weak ETag
```

**Strong vs Weak ETags:**

```http
// Strong ETag - byte-for-byte identical
ETag: "abc123"

// Weak ETag - semantically equivalent but not byte-identical
ETag: W/"abc123"
```

**Generation strategies:**

```javascript
// Hash of content
const crypto = require('crypto');
const etag = crypto.createHash('md5')
  .update(JSON.stringify(data))
  .digest('hex');

// Version number
const etag = `"v${resource.version}"`;

// Timestamp
const etag = `"${resource.updatedAt.getTime()}"`;
```

**Example workflow:**
```http
// Request
GET /api/document/42

// Response
HTTP/1.1 200 OK
ETag: "abc123"
Cache-Control: max-age=3600
{ "content": "..." }

// Cached request
GET /api/document/42
If-None-Match: "abc123"

// Not modified
HTTP/1.1 304 Not Modified
ETag: "abc123"

// Update request
PUT /api/document/42
If-Match: "abc123"
{ "content": "updated" }

// Success
HTTP/1.1 200 OK
ETag: "xyz789"
{ "content": "updated" }
```

---

### Cache-Control

**Purpose:** Directives for caching mechanisms.

**Mandatory:** No, but crucial for performance.

**Common Directives:**

```http
Cache-Control: no-cache
Cache-Control: no-store
Cache-Control: max-age=3600
Cache-Control: private
Cache-Control: public
Cache-Control: must-revalidate
Cache-Control: no-transform
```

**Directive Meanings:**

#### no-store
```http
Cache-Control: no-store
```
Don't cache at all (sensitive data).

#### no-cache
```http
Cache-Control: no-cache
```
Cache, but revalidate before using (check ETag/Last-Modified).

#### max-age
```http
Cache-Control: max-age=3600
```
Cache for 3600 seconds (1 hour).

#### private vs public
```http
Cache-Control: private
// Only browser can cache (not CDN/proxies)

Cache-Control: public
// Anyone can cache (CDN, proxies, browser)
```

#### Combined directives
```http
Cache-Control: public, max-age=3600, must-revalidate
Cache-Control: private, no-cache, no-store, must-revalidate
```

**Best practices by resource type:**

```javascript
// Static assets
Cache-Control: public, max-age=31536000, immutable

// User profile (authenticated)
Cache-Control: private, max-age=300

// Real-time data
Cache-Control: no-cache, must-revalidate

// Sensitive data
Cache-Control: no-store, no-cache, must-revalidate, private

// API responses (moderate caching)
Cache-Control: private, max-age=60
```

---

### Last-Modified

**Purpose:** Timestamp when resource was last modified.

**Mandatory:** No.

**Format:**
```http
Last-Modified: Wed, 21 Oct 2025 07:28:00 GMT
```

**Used with If-Modified-Since:**
```http
// First request
GET /api/document

Response:
HTTP/1.1 200 OK
Last-Modified: Wed, 21 Oct 2025 07:28:00 GMT
Content-Type: application/json

{ "content": "..." }

// Subsequent request
GET /api/document
If-Modified-Since: Wed, 21 Oct 2025 07:28:00 GMT

Response (not modified):
HTTP/1.1 304 Not Modified
Last-Modified: Wed, 21 Oct 2025 07:28:00 GMT

Response (modified):
HTTP/1.1 200 OK
Last-Modified: Thu, 22 Oct 2025 09:15:00 GMT
{ "content": "updated..." }
```

**ETag vs Last-Modified:**

| Feature | ETag | Last-Modified |
|---------|------|---------------|
| Precision | High (content hash) | Low (1 second) |
| Use case | Version tracking | Time-based cache |
| Size | Larger | Smaller |
| Generation | Hash computation | Timestamp |

**Recommendation:** Use both for maximum compatibility.

---

### Expires

**Purpose:** Date/time after which response is considered stale.

**Mandatory:** No.

**Format:**
```http
Expires: Thu, 01 Jan 2026 00:00:00 GMT
```

**Note:** Cache-Control: max-age takes precedence over Expires.

**Example:**
```http
HTTP/1.1 200 OK
Expires: Thu, 01 Jan 2026 00:00:00 GMT
Cache-Control: max-age=3600
```

---

### Retry-After

**Purpose:** Indicates how long to wait before making another request.

**Mandatory:** Recommended for 429, 503 responses.

**Format:**
```http
Retry-After: 120
Retry-After: Wed, 21 Oct 2025 07:28:00 GMT
```

**Examples:**

#### Rate Limiting (429)
```http
HTTP/1.1 429 Too Many Requests
Retry-After: 60
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1705068000

{
  "error": "Rate limit exceeded",
  "retryAfter": 60
}
```

#### Service Unavailable (503)
```http
HTTP/1.1 503 Service Unavailable
Retry-After: 300

{
  "error": "Service temporarily unavailable",
  "message": "Scheduled maintenance",
  "retryAfter": 300
}
```

---

### Access-Control-* (CORS Headers)

**Purpose:** Enable cross-origin resource sharing.

**Mandatory:** Required for cross-origin requests.

#### Access-Control-Allow-Origin
```http
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Origin: *  // Any origin (use carefully!)
```

#### Access-Control-Allow-Methods
```http
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
```

#### Access-Control-Allow-Headers
```http
Access-Control-Allow-Headers: Content-Type, Authorization
```

#### Access-Control-Allow-Credentials
```http
Access-Control-Allow-Credentials: true
```

#### Access-Control-Max-Age
```http
Access-Control-Max-Age: 86400  // Cache preflight for 24 hours
```

#### Access-Control-Expose-Headers
```http
Access-Control-Expose-Headers: X-Request-ID, X-RateLimit-Remaining
```

**Complete CORS example:**

```http
// Preflight request
OPTIONS /api/users
Origin: https://frontend.example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type, Authorization

// Preflight response
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: https://frontend.example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 86400
Access-Control-Allow-Credentials: true

// Actual request
POST /api/users
Origin: https://frontend.example.com
Content-Type: application/json
Authorization: Bearer token123

// Actual response
HTTP/1.1 201 Created
Access-Control-Allow-Origin: https://frontend.example.com
Access-Control-Allow-Credentials: true
Location: /api/users/42
```

**Server implementation:**
```javascript
app.use((req, res, next) => {
  const origin = req.headers.origin;
  const allowedOrigins = [
    'https://frontend.example.com',
    'https://app.example.com'
  ];
  
  if (allowedOrigins.includes(origin)) {
    res.set('Access-Control-Allow-Origin', origin);
    res.set('Access-Control-Allow-Credentials', 'true');
    res.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
    res.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');
    res.set('Access-Control-Max-Age', '86400');
  }
  
  if (req.method === 'OPTIONS') {
    return res.status(204).end();
  }
  
  next();
});
```

---

### WWW-Authenticate

**Purpose:** Defines authentication method for accessing a resource.

**Mandatory:** Required with 401 responses.

**Format:**
```http
WWW-Authenticate: Bearer realm="API"
WWW-Authenticate: Basic realm="Admin Area"
```

**Example:**
```http
GET /api/protected

Response:
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="API", error="invalid_token"

{
  "error": "Unauthorized",
  "message": "Invalid or expired token"
}
```

---

## Custom Headers for REST APIs

### Rate Limiting Headers

**Convention:** Prefix with `X-RateLimit-`

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 45
X-RateLimit-Reset: 1705068000
X-RateLimit-Window: 3600
```

**Example:**
```http
GET /api/data

Response:
HTTP/1.1 200 OK
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 99
X-RateLimit-Reset: 1705068000
Content-Type: application/json

{ "data": "..." }
```

**When limit exceeded:**
```http
HTTP/1.1 429 Too Many Requests
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1705068000
Retry-After: 60

{
  "error": "Rate limit exceeded"
}
```

**Implementation:**
```javascript
app.use(async (req, res, next) => {
  const key = req.ip;
  const limit = 100;
  const window = 3600; // 1 hour
  
  const current = await redis.incr(`ratelimit:${key}`);
  if (current === 1) {
    await redis.expire(`ratelimit:${key}`, window);
  }
  
  const ttl = await redis.ttl(`ratelimit:${key}`);
  const resetTime = Math.floor(Date.now() / 1000) + ttl;
  
  res.set('X-RateLimit-Limit', limit);
  res.set('X-RateLimit-Remaining', Math.max(0, limit - current));
  res.set('X-RateLimit-Reset', resetTime);
  
  if (current > limit) {
    res.set('Retry-After', ttl);
    return res.status(429).json({ error: 'Rate limit exceeded' });
  }
  
  next();
});
```

---

### Pagination Headers

**Link Header (GitHub style):**
```http
Link: <https://api.example.com/users?page=3>; rel="next",
      <https://api.example.com/users?page=1>; rel="first",
      <https://api.example.com/users?page=10>; rel="last"
```

**Custom Headers:**
```http
X-Total-Count: 250
X-Page-Count: 10
X-Per-Page: 25
X-Current-Page: 3
```

**Example:**
```http
GET /api/users?page=2&limit=20

Response:
HTTP/1.1 200 OK
X-Total-Count: 150
X-Page-Count: 8
X-Per-Page: 20
X-Current-Page: 2
Link: <https://api.example.com/users?page=3&limit=20>; rel="next",
      <https://api.example.com/users?page=1&limit=20>; rel="first",
      <https://api.example.com/users?page=8&limit=20>; rel="last",
      <https://api.example.com/users?page=1&limit=20>; rel="prev"

[
  { "id": 21, "name": "..." },
  { "id": 22, "name": "..." },
  ...
]
```

---

### Request Tracking Headers

**X-Request-ID (for debugging):**
```http
X-Request-ID: abc-123-xyz-789
```

**Example:**
```http
POST /api/users
X-Request-ID: req-12345

Response:
HTTP/1.1 201 Created
X-Request-ID: req-12345
Location: /api/users/42
```

**Implementation:**
```javascript
const { v4: uuidv4 } = require('uuid');

app.use((req, res, next) => {
  const requestId = req.headers['x-request-id'] || uuidv4();
  req.id = requestId;
  res.set('X-Request-ID', requestId);
  
  // Log with request ID
  console.log(`[${requestId}] ${req.method} ${req.path}`);
  
  next();
});
```

**In error responses:**
```http
HTTP/1.1 500 Internal Server Error
X-Request-ID: req-12345

{
  "error": "Internal Server Error",
  "requestId": "req-12345",
  "message": "Please contact support with this request ID"
}
```

---

### API Version Headers

**Option 1: Custom header:**
```http
X-API-Version: 2
Accept: application/vnd.api.v2+json
```

**Option 2: Content negotiation:**
```http
Accept: application/vnd.myapi.v2+json
```

**Response:**
```http
HTTP/1.1 200 OK
X-API-Version: 2
Content-Type: application/json
```

---

### Deprecation Headers

**Warning about deprecated endpoints:**
```http
Deprecated: true
Sunset: Sat, 31 Dec 2025 23:59:59 GMT
Link: <https://api.example.com/docs/migration>; rel="deprecation"
```

**Example:**
```http
GET /api/v1/users

Response:
HTTP/1.1 200 OK
Deprecated: true
Sunset: Sat, 31 Dec 2025 23:59:59 GMT
Link: <https://api.example.com/v2/users>; rel="successor-version"
Warning: 299 - "API v1 is deprecated. Please migrate to v2 by Dec 31, 2025"

[...]
```

---

## Security Headers

### Strict-Transport-Security (HSTS)

**Purpose:** Force HTTPS connections.

```http
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
```

### X-Content-Type-Options

**Purpose:** Prevent MIME type sniffing.

```http
X-Content-Type-Options: nosniff
```

### X-Frame-Options

**Purpose:** Prevent clickjacking.

```http
X-Frame-Options: DENY
X-Frame-Options: SAMEORIGIN
```

### Content-Security-Policy

**Purpose:** Prevent XSS attacks.

```http
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'
```

### X-XSS-Protection

**Purpose:** Enable XSS filter (legacy, CSP is better).

```http
X-XSS-Protection: 1; mode=block
```

**Complete security headers example:**
```javascript
app.use((req, res, next) => {
  res.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
  res.set('X-Content-Type-Options', 'nosniff');
  res.set('X-Frame-Options', 'DENY');
  res.set('X-XSS-Protection', '1; mode=block');
  res.set('Content-Security-Policy', "default-src 'self'");
  next();
});
```

---

## Compression Headers

### Accept-Encoding (Request)
```http
Accept-Encoding: gzip, deflate, br
```

### Content-Encoding (Response)
```http
Content-Encoding: gzip
```

**Example:**
```http
GET /api/large-data
Accept-Encoding: gzip, br

Response:
HTTP/1.1 200 OK
Content-Encoding: gzip
Content-Type: application/json
Content-Length: 1024  // Compressed size
Vary: Accept-Encoding

[gzipped data]
```

**Implementation:**
```javascript
const compression = require('compression');

app.use(compression({
  threshold: 1024, // Only compress if > 1KB
  level: 6,        // Compression level (1-9)
  filter: (req, res) => {
    // Don't compress if no-transform in Cache-Control
    if (req.headers['cache-control']?.includes('no-transform')) {
      return false;
    }
    return compression.filter(req, res);
  }
}));
```

---

## Header Best Practices

### 1. Always Use Standard Headers When Available

```javascript
// ✅ Good - Standard headers
Authorization: Bearer token123
Content-Type: application/json
Cache-Control: max-age=3600

// ❌ Avoid - Custom when standard exists
X-Auth-Token: token123
X-Content-Format: json
X-Cache-Time: 3600
```

### 2. Prefix Custom Headers with X-

```javascript
// ✅ Good
X-Request-ID: abc-123
X-RateLimit-Remaining: 99
X-API-Version: 2

// ❌ Confusing (looks standard)
Request-ID: abc-123
RateLimit: 99
```

**Note:** RFC 6648 deprecated X- prefix, but it's still widely used for clarity.

### 3. Be Consistent Across Your API

```javascript
// ✅ Consistent naming
X-Request-ID
X-Correlation-ID
X-API-Version

// ❌ Inconsistent
X-Request-ID
correlation_id
ApiVersion
```

### 4. Document All Custom Headers

```yaml
# OpenAPI specification
components:
  headers:
    X-RateLimit-Limit:
      description: Maximum requests per hour
      schema:
        type: integer
    X-RateLimit-Remaining:
      description: Remaining requests in current window
      schema:
        type: integer
```

### 5. Set Appropriate Cache Headers

```javascript
// Public, cacheable data
app.get('/api/public/products', (req, res) => {
  res.set('Cache-Control', 'public, max-age=3600');
  res.set('ETag', generateETag(products));
  res.json(products);
});

// Private user data
app.get('/api/user/profile', authenticate, (req, res) => {
  res.set('Cache-Control', 'private, max-age=300');
  res.set('ETag', generateETag(profile));
  res.json(profile);
});

// Real-time data
app.get('/api/stock/prices', (req, res) => {
  res.set('Cache-Control', 'no-cache, must-revalidate');
  res.json(prices);
});

// Sensitive data
app.get('/api/user/payment-methods', authenticate, (req, res) => {
  res.set('Cache-Control', 'no-store, no-cache, must-revalidate, private');
  res.set('Pragma', 'no-cache');
  res.json(paymentMethods);
});
```

### 6. Include CORS Headers for Cross-Origin Requests

```javascript
// Simple approach
app.use((req, res, next) => {
  res.set('Access-Control-Allow-Origin', '*');
  res.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
  res.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  next();
});

// Better: Whitelist origins
const allowedOrigins = ['https://app.example.com', 'https://mobile.example.com'];

app.use((req, res, next) => {
  const origin = req.headers.origin;
  if (allowedOrigins.includes(origin)) {
    res.set('Access-Control-Allow-Origin', origin);
  }
  next();
});
```

### 7. Set Security Headers

```javascript
// Production API should have:
app.use((req, res, next) => {
  res.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
  res.set('X-Content-Type-Options', 'nosniff');
  res.set('X-Frame-Options', 'DENY');
  res.set('X-XSS-Protection', '1; mode=block');
  next();
});
```

### 8. Provide Meaningful Rate Limit Info

```javascript
app.use((req, res, next) => {
  const limit = 100;
  const remaining = getRemainingRequests(req.ip);
  const resetTime = getResetTime(req.ip);
  
  res.set('X-RateLimit-Limit', limit);
  res.set('X-RateLimit-Remaining', remaining);
  res.set('X-RateLimit-Reset', resetTime);
  
  next();
});
```

---

## Extra Benefits from Headers

### 1. Performance Optimization

**Caching:**
```http
Cache-Control: public, max-age=3600
ETag: "abc123"
```
→ Reduces server load and response times by 70-90%

**Compression:**
```http
Accept-Encoding: gzip, br
Content-Encoding: gzip
```
→ Reduces bandwidth usage by 60-80%

**Conditional requests:**
```http
If-None-Match: "abc123"
→ 304 Not Modified (no body sent)
```
→ Saves bandwidth and processing

### 2. Enhanced Security

**HTTPS enforcement:**
```http
Strict-Transport-Security: max-age=31536000
```

**XSS protection:**
```http
Content-Security-Policy: default-src 'self'
X-Content-Type-Options: nosniff
```

**CORS control:**
```http
Access-Control-Allow-Origin: https://trusted.com
```

### 3. Better Debugging

**Request tracking:**
```http
X-Request-ID: abc-123-xyz
```
→ Trace requests through distributed systems

**Error context:**
```http
X-Request-ID: req-12345
X-Correlation-ID: corr-67890
```
→ Debug production issues

### 4. API Management

**Versioning:**
```http
X-API-Version: 2
```

**Deprecation warnings:**
```http
Deprecated: true
Sunset: Sat, 31 Dec 2025 23:59:59 GMT
```

**Rate limiting:**
```http
X-RateLimit-Remaining: 45
```
→ Clients can adjust behavior

### 5. Content Negotiation

**Format selection:**
```http
Accept: application/json
→ Server returns JSON

Accept: application/xml
→ Server returns XML
```

**Language selection:**
```http
Accept-Language: es-ES
→ Server returns Spanish content
```

**Compression:**
```http
Accept-Encoding: br
→ Server uses Brotli compression
```

### 6. Optimistic Locking

**Prevent lost updates:**
```http
If-Match: "v1"
→ Update only if version matches
→ Prevents concurrent modification issues
```

### 7. Analytics and Monitoring

**User-Agent analysis:**
```http
User-Agent: MyApp/2.0 (iOS 15)
```
→ Track client versions, detect issues

**Referer tracking:**
```http
Referer: https://google.com/search?q=product
```
→ Understand traffic sources

---

## Common Header Combinations

### Public API Response
```http
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Cache-Control: public, max-age=3600
ETag: "abc123"
Content-Encoding: gzip
Access-Control-Allow-Origin: *
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 950
X-Request-ID: req-12345
```

### Authenticated User Response
```http
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Cache-Control: private, max-age=300
ETag: "xyz789"
Access-Control-Allow-Origin: https://app.example.com
Access-Control-Allow-Credentials: true
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 75
X-Request-ID: req-67890
```

### Resource Creation
```http
HTTP/1.1 201 Created
Location: /api/users/42
Content-Type: application/json; charset=utf-8
ETag: "new123"
X-Request-ID: req-99999
```

### Error Response
```http
HTTP/1.1 429 Too Many Requests
Content-Type: application/json; charset=utf-8
Retry-After: 60
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1705068000
X-Request-ID: req-error-123
```

---

## Summary

### Mandatory Headers

**Request:**
- `Host` (HTTP/1.1 requirement)
- `Content-Type` (when sending body)
- `Authorization` (for protected endpoints)

**Response:**
- `Content-Type` (when sending body)
- `Location` (for 201 and 3xx responses)
- `WWW-Authenticate` (for 401 responses)

### Highly Recommended Headers

**Performance:**
- `Cache-Control`, `ETag`, `Last-Modified`
- `Accept-Encoding`, `Content-Encoding`

**Security:**
- `Strict-Transport-Security`
- `X-Content-Type-Options`
- `Access-Control-Allow-Origin` (CORS)

**API Management:**
- `X-RateLimit-*`
- `X-Request-ID`

### Key Takeaways

1. **Standard headers first** - Use established headers before creating custom ones
2. **Caching = Performance** - Cache-Control and ETags can reduce load by 70-90%
3. **Security matters** - Include security headers in all responses
4. **Track requests** - X-Request-ID helps debugging
5. **Rate limits** - Communicate limits clearly with headers
6. **CORS configuration** - Essential for browser-based clients
7. **Document everything** - Custom headers need clear documentation

---

## Next Steps

Now that you understand HTTP headers, explore:
- Implementing caching strategies
- CORS configuration in depth
- Security headers and best practices
- Rate limiting implementation
- Request tracking and distributed tracing
